<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-02-08 Do 16:41 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Virtual network with Openswitch</title>
<meta name="author" content="Sebastian Meisel" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="mystyle.css" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">Virtual network with Openswitch</h1>


<div id="outline-container-org9dbaf62" class="outline-2">
<h2 id="org9dbaf62">Virtuelle Netzwerke mit Openswitch und Linux Netzwerk-Namespaces</h2>
<div class="outline-text-2" id="text-org9dbaf62">
<input type="checkbox" id="darkmode-toggle">
<label for="darkmode-toggle"></label></input>
<script src="script.js"></script>

<p>
In diesem Projekt möchte ich zeigen, wie man ein virtuelles Netzwerk unter Linux mithilfe von Openvswitch und Netzwerk-Namespaces entwirft und implementiert. Durch die Nutzung virtueller Ethernet-Tunnel und eines zentralen virtuellen Switches schaffen wir eine flexible und skalierbare Netzwerkumgebung. Dieses Projekt zielt darauf ab, die Möglichkeiten virtueller Netzwerktechnologien zu demonstrieren und ein praktisches Beispiel für Bildungszwecke bereitzustellen.
</p>

<p>
Das folgende Diagramm veranschaulicht den Aufbau eines virtuellen Netzwerks unter Verwendung von Openswitch. Der vSwitch dient als zentraler Punkt und verbindet drei verschiedene Netzwerk-Namespaces: red, green, blue. Jeder Namespace erhält eine IP-Adresse (<code>eth0-r</code>, <code>eth0-g</code>, <code>eth0-b</code>) innerhalb des Subnetzes <code>10.0.0.0/24</code> und ist über virtuelle Ethernet-Schnittstellen (<code>veth-r</code>, <code>veth-g</code>, <code>veth-b</code>) mit dem vSwitch verbunden.
</p>



<div id="org81f6a86" class="figure">
<p><img src="img/ovs-net.png" alt="Netzwerkdiagramm, das die Beziehung zwischen den Namensräumen wie oben beschriebenen zeigt." width="50%" />
</p>
<p><span class="figure-number">Figure 1: </span>Network Diagram</p>
</div>
</div>

<div id="outline-container-orgdfd6d6c" class="outline-3">
<h3 id="orgdfd6d6c">Eine Funktion für jeden Namespace</h3>
<div class="outline-text-3" id="text-orgdfd6d6c">
<p>
Zunächst definieren wir Funktionen für jeden Netzwerk-Namensraum: grün, rot, orange (als Reserve für zukünftige Projekte) und blau. Diese Funktionen ermöglichen das Ausführen von Befehlen innerhalb der jeweiligen Namensräume unter Verwendung des Befehls <code>ip netns exec</code>. Jede Funktion ändert die Farbausgabe der ausgeführten Befehle zur besseren visuellen Identifizierung.
</p>



<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b6a0ff;">function</span> <span style="color: #feacd0;">green</span> () {
    <span style="color: #b6a0ff;">if</span> [[ $<span style="color: #00d3d0;">1</span> = <span style="color: #79a8ff;">"bash"</span> ]]
    <span style="color: #b6a0ff;">then</span>
        <span style="color: #f78fe7;">echo</span> <span style="color: #79a8ff;">"To risky for my taste"</span>
    <span style="color: #b6a0ff;">else</span>
        <span style="color: #f78fe7;">echo</span> -ne <span style="color: #79a8ff;">'\e[32m'</span>
        ip netns exec green $<span style="color: #00d3d0;">@</span>
        <span style="color: #f78fe7;">echo</span> -ne <span style="color: #79a8ff;">'\e[0m'</span>
    <span style="color: #b6a0ff;">fi</span>
    }
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b6a0ff;">function</span> <span style="color: #feacd0;">red</span> () {
    <span style="color: #b6a0ff;">if</span> [[ $<span style="color: #00d3d0;">1</span> = <span style="color: #79a8ff;">"bash"</span> ]]
    <span style="color: #b6a0ff;">then</span>
        <span style="color: #f78fe7;">echo</span> <span style="color: #79a8ff;">"To risky for my taste"</span>
    <span style="color: #b6a0ff;">else</span>
        <span style="color: #f78fe7;">echo</span> -ne <span style="color: #79a8ff;">'\e[31m'</span>
        ip netns exec red $<span style="color: #00d3d0;">@</span>
        <span style="color: #f78fe7;">echo</span> -ne <span style="color: #79a8ff;">'\e[0m'</span>
    <span style="color: #b6a0ff;">fi</span>
    }
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b6a0ff;">function</span> <span style="color: #feacd0;">orange</span> () {
    <span style="color: #b6a0ff;">if</span> [[ $<span style="color: #00d3d0;">1</span> = <span style="color: #79a8ff;">"bash"</span> ]]
    <span style="color: #b6a0ff;">then</span>
        <span style="color: #f78fe7;">echo</span> <span style="color: #79a8ff;">"To risky for my taste"</span>
    <span style="color: #b6a0ff;">else</span>
        <span style="color: #f78fe7;">echo</span> -ne <span style="color: #79a8ff;">'\e[33m'</span>
        ip netns exec orange $<span style="color: #00d3d0;">@</span>
        <span style="color: #f78fe7;">echo</span> -ne <span style="color: #79a8ff;">'\e[0m'</span>
    <span style="color: #b6a0ff;">fi</span>
    }
</pre>
</div>


<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b6a0ff;">function</span> <span style="color: #feacd0;">blue</span> () {
    <span style="color: #b6a0ff;">if</span> [[ $<span style="color: #00d3d0;">1</span> = <span style="color: #79a8ff;">"bash"</span> ]]
    <span style="color: #b6a0ff;">then</span>
        <span style="color: #f78fe7;">echo</span> <span style="color: #79a8ff;">"To risky for my taste"</span>
    <span style="color: #b6a0ff;">else</span>
        <span style="color: #f78fe7;">echo</span> -ne <span style="color: #79a8ff;">'\e[34m'</span>
        ip netns exec blue $<span style="color: #00d3d0;">@</span>
        <span style="color: #f78fe7;">echo</span> -ne <span style="color: #79a8ff;">'\e[0m'</span>
    <span style="color: #b6a0ff;">fi</span>
    }
</pre>
</div>
</div>
</div>

<div id="outline-container-org23f1b7b" class="outline-3">
<h3 id="org23f1b7b">Namensräume erstellen</h3>
<div class="outline-text-3" id="text-org23f1b7b">
<p>
Der nächste Schritt besteht darin, die drei Netzwerk-Namensräume namens rot, grün und blau mit dem Befehl <code>ip netns add</code> zu initialisieren. Anschließend wird die Loopback-Schnittstelle innerhalb jedes Namensraums mit dem Befehl <code>ip l dev lo up</code> aktiviert, um die lokale Kommunikation innerhalb des Namensraums zu ermöglichen. Schließlich wird der aktuelle Zustand der Netzwerkschnittstellen innerhalb jedes Namensraums mit dem Befehl <code>ip l</code> angezeigt.
</p>

<div class="org-src-container">
<pre class="src src-bash">ip netns add red
ip netns add green
ip netns add blue
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">red ip l dev lo up
green ip l dev lo up
blue ip l dev lo up
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">red ip l
green ip l
blue ip l
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb5980ab" class="outline-3">
<h3 id="orgb5980ab">Tunnel erstellen</h3>
<div class="outline-text-3" id="text-orgb5980ab">
<p>
Nun erstellen wir virtuelle Ethernet-Tunnel (veth) namens <code>veth-r</code>, <code>veth-g</code> und <code>veth-b</code>, die jeweils mit einer Schnittstelle in ihrem jeweiligen Netzwerk-Namensraum (<code>eth0-r</code>, <code>eth0-g</code>, <code>eth0-b</code>) für die Kommunikation gekoppelt sind. Diese Tunnel erleichtern die Kommunikation zwischen dem vSwitch und den Netzwerk-Namensräumen.
</p>

<div class="org-src-container">
<pre class="src src-bash">ip link add veth-r type veth peer eth0-r
ip link add veth-g type veth peer eth0-g
ip link add veth-b type veth peer eth0-b
</pre>
</div>
</div>
</div>

<div id="outline-container-org18c40b8" class="outline-3">
<h3 id="org18c40b8">Verknüpfung in Namensräume platzieren</h3>
<div class="outline-text-3" id="text-org18c40b8">
<p>
Nachdem die Tunnel erstellt wurden, ist der nächste Schritt, die Schnittstellen ihren jeweiligen Namensräumen zuzuweisen. Dies wird erreicht, indem jedem Endpunkt eines Tunnels (<code>eth0-r</code>, <code>eth0-g</code>, <code>eth0-b</code>) sein entsprechender Namensraum (red, green, blue) zugeordnet wird.
</p>


<div class="org-src-container">
<pre class="src src-bash">ip link set eth0-r netns red
ip link set eth0-g netns green
ip link set eth0-b netns blue
</pre>
</div>
</div>
</div>

<div id="outline-container-org1131680" class="outline-3">
<h3 id="org1131680">IPv4-Adressen hinzufügen</h3>
<div class="outline-text-3" id="text-org1131680">
<p>
Schließlich werden IPv4-Adressen den Schnittstellen innerhalb jedes Namensraums zugewiesen, um die Netzwerkkommunikation zu ermöglichen. Die IP-Adressen <code>10.0.0.2</code>, <code>10.0.0.3</code> und <code>10.0.0.4</code> mit einer <code>/24</code> Subnetzmaske werden den Schnittstellen <code>eth0-r</code>, <code>eth0-g</code> und <code>eth0-b</code> jeweils zugewiesen. Zusätzlich werden die Schnittstellen aktiviert, um die Netzwerkkonfiguration zu aktivieren.
</p>


<div class="org-src-container">
<pre class="src src-bash">red ip address add 10.0.0.2/24 dev eth0-r
red ip link set dev eth0-r up
green ip address add 10.0.0.3/24 dev eth0-g
green ip link set dev eth0-g up
blue ip address add 10.0.0.4/24 dev eth0-b
blue ip link set dev eth0-b up
</pre>
</div>
</div>
</div>


<div id="outline-container-org73a28cd" class="outline-3">
<h3 id="org73a28cd">Open Virtual Switch</h3>
<div class="outline-text-3" id="text-org73a28cd">
</div>
<div id="outline-container-orgbb910f2" class="outline-4">
<h4 id="orgbb910f2">Installieren</h4>
<div class="outline-text-4" id="text-orgbb910f2">
<p>
Um den virtuellen Switch einzurichten, wird zunächst das Openvswitch-Paket mithilfe des passenden Paketmanagers installiert. Anschließend wird der <code>ovs-vswitchd</code> Dienst gestartet, um den Switch zu verwalten.
</p>


<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b6a0ff;">if</span> [ -f /etc/os-release ]; <span style="color: #b6a0ff;">then</span>
    <span style="color: #f78fe7;">.</span> /etc/os-release
<span style="color: #b6a0ff;">else</span>
    <span style="color: #f78fe7;">echo</span> <span style="color: #79a8ff;">"Cannot determine the Linux distribution."</span>
    <span style="color: #b6a0ff;">exit</span> 1
<span style="color: #b6a0ff;">fi</span>
<span style="color: #b6a0ff;">case</span> $<span style="color: #00d3d0;">ID_LIKE</span><span style="color: #b6a0ff;"> in</span>
    debian|ubuntu)
        apt install -y openvswitch-switch
        ;;
    fedora|rhel|centos)
        yum install -y openvswitch
        ;;
    suse)
        zypper install -y openvswitch
        ;;
    arch)
        pacman -Syu openvswitch
        ;;
    *)
        <span style="color: #f78fe7;">echo</span> <span style="color: #79a8ff;">"Unsupported distribution."</span>
        <span style="color: #b6a0ff;">exit</span> 1
        ;;
<span style="color: #b6a0ff;">esac</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">systemctl start ovs-vswitchd.service
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org8ca963e"></a>Virtuellen Switch hinzufügen<br />
<div class="outline-text-5" id="text-org8ca963e">
<p>
Nach der Installation wird ein virtueller Switch mit dem Namen <code>SW1</code> mithilfe des Befehls <code>ovs-vsctl add-br</code> erstellt. Die Switch-Konfiguration wird mithilfe des Befehls <code>ovs-vsctl show</code> angezeigt.
</p>

<div class="org-src-container">
<pre class="src src-bash">ovs-vsctl add-br SW1
ovs-vsctl show
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgcd92a28" class="outline-4">
<h4 id="orgcd92a28">Ports hinzufügen</h4>
<div class="outline-text-4" id="text-orgcd92a28">
<p>
Als nächstes werden Ports zum virtuellen Switch hinzugefügt, um ihn mit den Netzwerk-Namensräumen zu verbinden. Jeder Port ist mit einer entsprechenden Tunnel-Schnittstelle (<code>veth-r</code>, <code>veth-g</code>, <code>veth-b</code>) verbunden.
</p>


<div class="org-src-container">
<pre class="src src-bash">ovs-vsctl add-port SW1 veth-r
ovs-vsctl add-port SW1 veth-b
ovs-vsctl add-port SW1 veth-g
ovs-vsctl show
</pre>
</div>

<p>
Diese Ports müssen nun noch aktiviert werden.
</p>

<div class="org-src-container">
<pre class="src src-bash">ip link set veth-r up
ip link set veth-g up
ip link set veth-b up
ip a | grep veth -A3
</pre>
</div>

<p>
Conclusion
</p>

<p>
Zusammenfassend zeigt unsere virtuelle Netzwerkkonfiguration die Vielseitigkeit und Effizienz von softwaredefinierten Netzwerk (SDN)-Lösungen. Durch die Abstraktion von Netzwerkfunktionalitäten in virtualisierte Komponenten ermöglichen wir eine einfachere Verwaltung, erhöhte Flexibilität und eine bessere Ressourcennutzung. Dieses Projekt dient als Grundlage für weitere Erkundungen und Experimente im Bereich virtualisierter Netzwerkumgebungen.
</p>

<p>
Jetzt können Sie die verschiedenen Namensräume erkunden, indem Sie netzwerkbezogene Befehle mit den Funktionen <code>red()</code>, <code>blue()</code> und <code>green()</code> aufrufen, wie:
</p>

<div class="org-src-container">
<pre class="src src-bash">blue ip route
red ping 10.0.0.3 -c 5
green nstat -s | grep -i icmp
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Sebastian Meisel</p>
<p class="date">Created: 2024-02-08 Do 16:41</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
