<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-06-16 Mo 09:49 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="author" content="Sebastian Meisel" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="mystyle.css" />
</head>
<body>
<div id="content" class="content">


<div id="org327ecc4" class="figure">
<p><img src="img/Ostseepinguin.png" alt="Das Ostseepinguin-Banner zeigt einen Pinguin am Ostseestrand." width="100%" />
</p>
</div>

<input type="checkbox" id="darkmode-toggle">
<label for="darkmode-toggle"></label></input>
<script src="script.js"></script>

<div class="menu" id="org1ee835d">
<p>
<a href="IPv6PrefixDelegation.html">üá∫üá∏ EN</a>
</p>

<p>
-&gt; <a href="index.DE.html">Startseite</a>
</p>

<p>
&#x2014;
</p>
<p width="16px" alt="Mastodon">
<img src="img/Mastodon.png" alt="Mastodon" width="16px" /> <a href="https://emacs.ch/@SebasTEAan">https://emacs.ch/@SebasTEAan</a>
</p>

<p>
üìß <a href="mailto:sebastian.meisel+ostseepinguin@gmail.com">sebastian.meisel at gmail.com</a>
</p>

</div>
<div id="outline-container-org5ba277f" class="outline-2">
<h2 id="org5ba277f">Einleitung</h2>
<div class="outline-text-2" id="text-org5ba277f">
<p>
Vor Kurzem hat mir mein <code>ISP</code> (Internetdienstanbieter) endlich modernes <code>IPv6</code> bereitgestellt. Ich habe zumindest ein <code>/60</code>-Pr√§fix erhalten, was mir erlaubt, Subnetze zu bilden ‚Äì bis zu 16, da die Netzwerkkennung bei <code>IPv6</code> 64 Bit lang ist. So weit, so gut. Aber ich habe schnell gemerkt, dass sich dieses Pr√§fix h√§ufig √§ndert, genau wie das <code>IPv4</code>-Pr√§fix. Das ist jedoch ein Problem: Ich habe neben meinem Standardnetz zwei VLANs, die jeweils ein eigenes <code>GUA</code> (Global Unicast Address)-Pr√§fix ben√∂tigen. Wann immer sich mein Pr√§fix √§ndert, m√ºsste ich die VLAN-Konfigurationen und die Routen anpassen. Das ist nicht praktikabel.
</p>

<p>
Gl√ºcklicherweise gibt es eine L√∂sung f√ºr dieses Problem: <code>IPv6</code>-Pr√§fix-Delegation (<code>PD</code>).
</p>
</div>
<div id="outline-container-orgb56ff75" class="outline-3">
<h3 id="orgb56ff75">Wie funktioniert das?</h3>
<div class="outline-text-3" id="text-orgb56ff75">
<p>
Mit klassischem <code>DHCP</code> lassen sich automatisch <code>IPv4</code>-Adressen und andere Konfigurationsdaten an Clients verteilen. Mit modernem <code>ICMPv6</code> geht das nat√ºrlich auch. Aber es geht noch besser: Mit <code>PD</code> kann man Ger√§ten ganze Netzpr√§fixe zuweisen.
</p>

<p>
Genau so bekommt auch dein Heimrouter das <code>IPv6</code>-Pr√§fix vom <code>ISP</code>: Der Heimrouter fordert √ºber den <code>DHCPv6</code>-Server des <code>ISP</code> ein Pr√§fix an. Der Server antwortet mit einem bestimmten Pr√§fix, das er delegiert. Wenn dein Heimrouter <code>IA_PD</code> unterst√ºtzt, kannst du sogar mit einem internen Router (z. B. einem Linux-Rechner) selbst wieder einen Teil dieses Pr√§fixes anfordern und eigene Netze (z. B. VLANs) bedienen ‚Äì wie in meinem Fall.
</p>


<div id="orge673ba0" class="figure">
<p><img src="img/IPv6PD.png" alt="Links: Diagramm zur IPv6-Pr√§fix-Delegation. Der ISP weist ein /60-Pr√§fix (3fff:abcd:0:abcd::/60) dem Heimrouter zu. Der Heimrouter delegiert daraus zwei /64-Pr√§fixe ‚Äì 3fff:abcd:dcbd:abdc::/64 und 3fff:abcd:dcbd:abdd::/64 ‚Äì an zwei nachgeschaltete Ger√§te, nachdem diese jeweils angefragt haben." width="80%" />
</p>
</div>

<p>
Die einzelnen Schnittstellen des nachgeschalteten Routers k√∂nnen nun selbst ein <code>/64/-Netz anfordern und sich eine ~IPv6</code>-Adresse aus diesem Netz zuweisen lassen.
</p>
</div>
</div>
<div id="outline-container-org2f9398b" class="outline-3">
<h3 id="org2f9398b">Netzwerkaufbau</h3>
<div class="outline-text-3" id="text-org2f9398b">
<p>
So sieht mein aktuelles Netzwerk aus:
</p>


<div id="org15f68d9" class="figure">
<p><img src="img/IPv6Network.png" alt="Links: Das Internet (als Wolke) ist √ºber Glasfaser mit einem Heimrouter verbunden. Von dort f√ºhrt ein Ethernet-Kabel zu einem Switch, der wiederum mit einem Raspberry Pi verbunden ist, der als Router dient. Oberhalb des Switches ist ein WLAN-Access-Point angeschlossen, der mobile Ger√§te im VLAN &quot;WLAN&quot; versorgt (orange eingef√§rbt). Unterhalb ist ein Desktop-PC im VLAN &quot;Office&quot; (violett eingef√§rbt) angeschlossen." width="80%" />
</p>
</div>

<p>
Mein Heimrouter bekommt ein /60-IPv6-Pr√§fix, das sich alle paar Tage √§ndert. An diesen Heimrouter ist ein Managed-Switch angeschlossen, √ºber den ich VLANs einrichten kann. Die Firewall, der DHCP(v6)-Server und der Router f√ºr diese VLANs laufen auf einem Raspberry Pi, der als "Router on a stick" fungiert: Er ist √ºber einen Trunk-Port mit dem Switch verbunden und besitzt zwei virtuelle Netzwerkschnitteln f√ºr die beiden VLANs ‚Äì Office (VLAN-ID 10) und WLAN (VLAN-ID 20).
</p>

<p>
Der WLAN-Access-Point ist √ºber einen Access-Port angeschlossen, der f√ºr VLAN 10 konfiguriert ist. Das Office-VLAN enth√§lt bisher nur meinen Desktop-PC.
</p>
</div>
</div>
<div id="outline-container-orgf652291" class="outline-3">
<h3 id="orgf652291">Konfiguration des Heimrouters</h3>
<div class="outline-text-3" id="text-orgf652291">
<p>
Zuerst musst du herausfinden, ob und wo du auf deinem Heimrouter die Option IA<sub>PD</sub> (Prefix Delegation) f√ºr DHCPv6 aktivieren kannst. Auf meinem Heimrouter (eine Fritz!Box) sieht das Men√º folgenderma√üen aus und ist unter <code>Heimnetz ‚Üí Netzwerk ‚Üí Netzwerkeinstellungen ‚Üí IPv6-Einstellungen</code> zu finden.
</p>


<div id="org63b6b38" class="figure">
<p><img src="img/IPv6PD_HomeRouter.png" alt="Screenshot der Fritz!Box mit aktivierter Option ‚ÄûDNS-Server, Pr√§fix (IA_PD) und IPv6-Adresse (IA_NA) zuweisen‚Äú unter ‚ÄûDHCPv6-Server im Heimnetz der Fritz!Box aktivieren‚Äú. Die Fritz!Box ist ein in Deutschland weit verbreiteter Heimrouter von AVM." width="80%" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orga554cdc" class="outline-2">
<h2 id="orga554cdc">Konfiguration des Raspberry Pi Routers</h2>
<div class="outline-text-2" id="text-orga554cdc">
<p>
Als n√§chstes m√ºssen wir den internen Router konfigurieren. Wie erw√§hnt, nutze ich einen Raspberry Pi, aber die folgenden Schritte sollten auf den meisten modernen Linux-Distributionen und mit beliebiger PC-Hardware funktionieren. Du k√∂nntest eventuell ein leistungsf√§higeres Ger√§t bevorzugen ‚Äì insbesondere mit mehr Bandbreite.
</p>

<p>
Ich habe mich zun√§chst im <a href="https://wiki.ubuntuusers.de/Router/Pr%C3%A4fix-Delegation/">ubuntuusers Wiki</a> informiert. Danach habe ich mich entschieden, <code>systemd-networkd</code> zur Konfiguration meiner Netzwerkschnittstellen zu verwenden. Ich nutze Raspberry Pi OS, das auf Debian Bookworm basiert. Standardm√§√üig kommt dort NetworkManager zum Einsatz.
</p>

<p>
<code>systemd-networkd</code> ist jedoch bereits installiert. Ich habe mich deshalb entschieden, erst alles zu konfigurieren und danach den <code>NetworkManager.service</code> zu deaktivieren und stattdessen <code>systemd-networkd.service</code> zu aktivieren.
</p>
</div>
<div id="outline-container-orgc690ce2" class="outline-4">
<h4 id="orgc690ce2">WAN-Schnittstelle konfigurieren</h4>
<div class="outline-text-4" id="text-orgc690ce2">
<p>
Ich beginne mit der physischen Schnittstelle, die als WAN-Schnittstelle dient:
</p>

<p>
Die ersten Zeilen enthalten allgemeine Einstellungen. Im Abschnitt <code>[Match]</code> musst du den Namen der Schnittstelle angeben, wie sie vom System benannt wurde. Bei mir ist es <code>eth0</code>, auf anderen Systemen k√∂nnte es <code>enp0s16f0u1</code> o.‚ÄØ√Ñ. sein. Au√üerdem muss der <code>[Typ]</code> der Schnittstelle angegeben werden, hier also <code>ether</code> f√ºr kabelgebundene Verbindungen. F√ºr <code>WLAN</code> w√§re es <code>wlan</code>. Du kannst auch nach anderen Kriterien matchen, z.‚ÄØB. <code>MACAddress</code>.
</p>

<p>
<code>/etc/systemd/network/10-eth0.network</code>
</p>
<div class="org-src-container">
<pre class="src src-text">[Match]
Name=eth0
Type=ether

</pre>
</div>

<p>
Als n√§chstes folgt der Abschnitt <code>[Network]</code>, beginnend mit einer Beschreibung. Der Text ist beliebig.
</p>
<div class="org-src-container">
<pre class="src src-text">[Network]
Description=WAN-Ethernet-Port

</pre>
</div>

<p>
Nun zum ersten interessanten Teil: Wir teilen <code>networkd</code> mit, dass es <code>DHCPv6</code> nutzen soll, um eine <code>IPv6</code>-Adresse zu beziehen, und dass es Router Advertisements (<code>RAs</code>) akzeptieren soll. Au√üerdem soll <code>IP-Forwarding</code> aktiviert sein.
</p>

<div class="org-src-container">
<pre class="src src-text">DHCP=ipv6
IPv6AcceptRA=yes
IPForward=yes
</pre>
</div>

<p>
Hier geben wir auch an, welche <code>VLANs</code> mit dieser Schnittstelle verkn√ºpft werden:
</p>
<div class="org-src-container">
<pre class="src src-text">VLAN=Office
VLAN=WLAN

</pre>
</div>

<p>
Da in der Regel ein Dual-Stack-Betrieb sinnvoll ist, setzen wir eine statische <code>IPv4</code>-Adresse passend zum lokalen Netz:
</p>
<div class="org-src-container">
<pre class="src src-text">[Address]
Address=192.168.178.254
Gateway=192.168.178.1

</pre>
</div>

<p>
Die <code>IPv4</code>-Default-Route darf nicht fehlen. F√ºr <code>IPv6</code> ist das nicht n√∂tig ‚Äì das √ºbernimmt der <code>DHCPv6</code>-Client.
</p>
<div class="org-src-container">
<pre class="src src-text">[Route]
Gateway=192.168.178.1

</pre>
</div>

<p>
Nun zum wichtigsten Teil: <code>IA_PD</code> aktivieren:
</p>

<dl class="org-dl">
<dt>PrefixDelegationHint:</dt><dd>Die gew√ºnschte Pr√§fixgr√∂√üe ‚Äì sie muss gr√∂√üer als das Pr√§fix, dass dein ISP dir liefert (bei mir <code>/60/</code>), aber h√∂chstens <code>/64</code> sein. Ich habe mich f√ºr <code>/62</code> entschieden, was vier Subnetze erlaubt.<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup></dd>
<dt>UseDelegatedPrefix:</dt><dd>Aktiviert die Nutzung der Prefix Delegation.</dd>
<dt>UseAddress:</dt><dd>Optional ‚Äì unterdr√ºckt Warnungen, dass Adressen nicht verwendet werden.</dd>
</dl>

<div class="org-src-container">
<pre class="src src-text">[DHCPv6]
PrefixDelegationHint=::/62
UseDelegatedPrefix=yes
UseAddress=no
</pre>
</div>
</div>
</div>
<div id="outline-container-org3879c53" class="outline-4">
<h4 id="org3879c53">VLAN-Ger√§te konfigurieren</h4>
<div class="outline-text-4" id="text-org3879c53">
<p>
Im n√§chsten Schritt richten wir die virtuellen Ger√§te f√ºr die <code>VLANs</code> ein. Daf√ºr muss <b>jeweils</b> eine Datei vom Typ <code>.netdev</code> unter <code>/etc/systemd/network/</code> angelegt werden. Diese Dateien sollten mit <code>00-</code> beginnen, damit sie vor der Konfiguration der physischen Schnittstelle verarbeitet werden.
</p>

<p>
Jede Datei enth√§lt zwei Abschnitte:
</p>

<dl class="org-dl">
<dt>[NetDev]:</dt><dd>Hier wird das virtuelle Ger√§t mit <code>Name</code> und <code>Kind=vlan</code> definiert.</dd>
<dt>[VLAN]:</dt><dd>Hier wird die <code>VLAN-Id</code> festgelegt (zwischen 1 und 4096), passend zur Konfiguration auf dem Switch.</dd>
</dl>

<div class="org-src-container">
<pre class="src src-text">[NetDev]
Name=Office
Kind=vlan

[VLAN]
Id=10
</pre>
</div>

<p>
F√ºr <b>jedes</b> <code>VLAN</code> brauchen wir zus√§tzlich eine passende <code>.network</code>-Datei. Diese sollte mit einer h√∂heren Nummer (z.‚ÄØB. <code>20-</code>) beginnen als die der physischen Schnittstelle.
</p>

<p>
Im Abschnitt <code>[Match]</code> geben wir den Namen des <code>VLAN</code>-Ger√§ts an. Der <code>Typ</code> ist <code>vlan</code>.
</p>
<div class="org-src-container">
<pre class="src src-text">[Match]
Name=Office
Type=vlan
</pre>
</div>

<p>
Im Abschnitt <code>[Network]</code> erfolgt die eigentliche Netzwerkkonfiguration:
</p>

<dl class="org-dl">
<dt>DHCP=ipv6:</dt><dd>Aktiviert <code>DHCPv6</code>.</dd>
<dt>IPForward:</dt><dd>Weiterleitung aktivieren.</dd>
<dt>IPv6SendRA:</dt><dd>Router Advertisements (<code>RAs</code>) senden.</dd>
<dt>IPv6AcceptRA:</dt><dd>Empfang von <code>RAs</code> (hier meist auf ‚Äûno‚Äú).</dd>
<dt>DHCPPrefixDelegation:</dt><dd>Aktiviert <code>IA_PD</code>.</dd>
</dl>

<div class="org-src-container">
<pre class="src src-text">[Network]
Description=Office VLAN Interface
DHCP=ipv6
IPForward=yes
IPv6SendRA=yes
IPv6AcceptRA=no
DHCPPrefixDelegation=yes
</pre>
</div>

<p>
Auch eine <code>IPv4</code>-Adresse sollte f√ºr Dual-Stack vergeben werden:
</p>
<div class="org-src-container">
<pre class="src src-text">[Address]
Address=172.16.10.1/24
</pre>
</div>

<p>
Der Abschnitt <code>[IPv6PrefixDelegation]</code> steuert die Zuweisung des Subnetzes:
</p>
<dl class="org-dl">
<dt>ULA=true:</dt><dd>Aktiviert Unique Local Addresses (optional)</dd>
<dt>SubnetId=0x1:</dt><dd>W√§hlt das gew√ºnschte Subnetz (z.‚ÄØB. <code>0x1</code> f√ºr das zweite Subnetz). Die Nummerierung der Subnetze wird hexadezimal geschrieben. <code>0xf</code> w√§re also das 15te Netzwerk.</dd>
</dl>

<div class="org-src-container">
<pre class="src src-text">[IPv6PrefixDelegation]
ULA=true
SubnetId=0x1

</pre>
</div>
</div>
</div>
<div id="outline-container-orgd66129c" class="outline-4">
<h4 id="orgd66129c">Wechsel zu systemd-networkd</h4>
<div class="outline-text-4" id="text-orgd66129c">
<p>
Wenn alles konfiguriert ist, deaktivieren wir <code>NetworkManager</code> und aktivieren stattdessen <code>systemd-networkd</code>:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo systemctl disable --now NetworkManager.service
sudo systemctl enable --now systemd-networkd.service
</pre>
</div>

<p>
Mit folgendem Befehl pr√ºfst du, ob alles l√§uft:
</p>
<div class="org-src-container">
<pre class="src src-bash">systemctl status systemd-networkd
</pre>
</div>

<p>
Beispielausgabe:
</p>
<pre class="example" id="org1c8045d">
‚óè systemd-networkd.service - Network Configuration
Loaded: loaded (/lib/systemd/system/systemd-networkd.service; enabled)
Active: active (running) since ...
</pre>

<p>
Du kannst dir auch die zugewiesenen Adressen anzeigen lassen mit:
</p>
<div class="org-src-container">
<pre class="src src-bash">ip --brief a
</pre>
</div>
</div>
</div>
<div id="outline-container-org31644b5" class="outline-3">
<h3 id="org31644b5">Konfiguration der Firewall</h3>
<div class="outline-text-3" id="text-org31644b5">
<p>
Es kann vorkommen, dass dein interner Router keine Adresse auf den <code>VLAN</code>-Interfaces erh√§lt. Das liegt h√§ufig daran, dass die f√ºr <code>DHCPv6</code> ben√∂tigten Ports blockiert werden. Der Server verwendet UDP-Port <code>547</code>, der Client UDP-Port <code>546</code>. Diese m√ºssen erlaubt werden.
</p>

<p>
Mit nftables f√ºgst du der Input-Kette folgende Regel hinzu:
</p>

<div class="org-src-container">
<pre class="src src-text">iifname "eth0" udp sport 547 udp dport 546 accept comment "Allow DHCPv6 from server to client"
</pre>
</div>

<p>
Falls du lieber <code>ufw</code> verwendest (z.‚ÄØB. unter Debian/Ubuntu):
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo ufw allow<span style="color: #b6a0ff;"> in</span> on eth0 proto udp from any port 547 to any port 546 comment <span style="color: #79a8ff;">'Allow DHCPv6 from server to client'</span>
</pre>
</div>

<p>
Oder unter Fedora, CentOS oder RHEL mit <code>firewalld</code>:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo firewall-cmd --permanent --add-rich-rule=<span style="color: #79a8ff;">'rule family="ipv6" source address="::/0" protocol value="udp" port port="547" protocol="udp" destination-port port="546" protocol="udp" interface name="eth0" accept'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfbec77a" class="outline-3">
<h3 id="orgfbec77a">Fazit</h3>
<div class="outline-text-3" id="text-orgfbec77a">
<p>
Mit diesem Setup erhalten alle Ger√§te in meinen <code>VLANs</code> automatisch eine g√ºltige <code>IPv6</code>-Adresse mit dem korrekten Pr√§fix ‚Äì auch wenn sich das Pr√§fix regelm√§√üig durch meinen Provider √§ndert. Die Routen werden ebenfalls automatisch gesetzt. Ich muss mich um nichts mehr k√ºmmern.
</p>

<p>
Das zeigt einmal mehr: <code>IPv6</code> ist moderner und einfacher als das veraltete <code>IPv4</code>.
</p>
</div>
</div>
<div id="outline-container-org9700b8a" class="outline-3">
<h3 id="org9700b8a">Fu√ünoten</h3>
<div class="outline-text-3" id="text-org9700b8a">
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Jeder zus√§tzliche Bit halbiert die Zahl m√∂glicher Subnetze. Ein /61 ergibt 8, ein /62 ergibt 4, ein /63 ergibt 2 und ein /64 genau 1 Subnetz.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="date">Date: 2025-06-04 Mi 00:00</p>
<p class="author">Author: Sebastian Meisel</p>
<p class="date">Created: 2025-06-16 Mo 09:49</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
